# TSBS Supplemental Guide: TDengine

TDengine is an open source time-series database with high performance, scalability and SQL support. 
This supplemental guide explains how
the data generated for TSBS is stored, additional flags available when
using the data importer (`tsbs_load_tdengine`), and additional flags
available for the query runner (`tsbs_run_queries_tdengine`). **This
should be read *after* the main README.**

## Data format

Data generated by `tsbs_generate_data` for TDengine is serialized in a
"pseudo-CSV" format. Each reading consists of a row, the first item is the operation type represented by 1, 2, 3.

- 1 means insert data, the format is:
    - `1,common table name,field count,insert data`
- 2 means to create a super table, the format is:
    - `2,super table name,common table name, create table sql`
- 3 means create an ordinary table, the format is:
    - `3,super table name,common table name,create table sql`

An example for the `cpu-only` use case:

```text
2,cpu,host_0,create table cpu (ts timestamp,usage_user bigint,usage_system bigint,usage_idle bigint,usage_nice bigint,usage_iowait bigint,usage_irq bigint,usage_softirq bigint,usage_steal bigint,usage_guest bigi
nt,usage_guest_nice bigint) tags (hostname binary(30),region binary(30),datacenter binary(30),rack binary(30),os binary(30),arch binary(30),team binary(30),service binary(30),service_version binary(30),service_e
nvironment binary(30))
3,cpu,host_0,create table host_0 using cpu (hostname,region,datacenter,rack,os,arch,team,service,service_version,service_environment) tags ('host_0','eu-central-1','eu-central-1a','6','Ubuntu15.10','x86','SF','1
9','1','test')
1,host_0,10,(1451606400000,58,2,24,61,22,63,6,44,80,38)
```

---

## `tsbs_load_tdengine` Additional Flags

### connection related
#### `-user` (type: `string`, default: `root`)

User to connect to TDengine

#### `-pass` (type: `string`, default: `taosdata`)

Password for user connecting to TDengine

#### `-host` (type: `string`)

Hostname of the TDengine server.

#### `-port` (type: `int`, default: `6030`)

Port of the TDengine server.

### TDengine Database related

There are many parameters for creating a TDengine database , See the [TDengine documentation][conn-str] for more details.

#### `-buffer` (type: `int`, default: `96`)

TDengine DB parameter: buffer, specifies the size (in MB) of the write buffer for each vnode. Enter a value between 3 and 16384.
 
#### `-pages` (type: `int`, default: `256`)

TDengine DB parameter: pages, specifies the number of pages in the metadata storage engine cache on each vnode. Enter a value greater than or equal to 64
 
#### `-stt_trigger` (type: `int`, default: `8`)

TDengine DB parameter: stt_trigger, specifies the number of file merges triggered by flushed files. ranging from 1 to 16
 
#### `-wal_level` (type: `int`, default: `1`)

TDengine DB parameter: wal_level , WAL_LEVEL: specifies whether fsync is enabled. The default value is 1.

1: WAL is enabled but fsync is disabled.

2: WAL and fsync are both enabled.

#### `-wal_fsync_perio` (type: `int`, default: `3000`)

TDengine DB parameter: wal_fsync_perio, specifies the interval (in milliseconds) at which data is written from the WAL to disk. This parameter takes effect only when the WAL parameter is set to 2. Enter a value between 0 and 180000. 
 
#### `-groups` (type: `int`, default: `2`)

TDengine DB parameter: stt_trigger, specifies the initial number of vgroups when a database is created. ranging from 0 to 4096.


#### `-db-name` (type: `string`, default: `benchmark`)

Name of database 


### Miscellaneous

#### `-hash-workers` (type: `boolean`, default: `false`)
Whether to consistently hash data across the multiple insert workers by the
value of the primary (first) tag. For datasets with larger numbers of
devices, this option helps improve data locality on disk which can lead
to better query performance. For datasets with smaller numbers of devices, it is typically not necessary.

[conn-str]: https://docs.tdengine.com/taos-sql/database/

## `tsbs_run_queries_tdengine` Additional Flags

#### `-user` (type: `string`, default: `root`)

User to connect to TDengine

#### `-pass` (type: `string`, default: `taosdata`)

Password for user connecting to TDengine

#### `-host` (type: `string`)

Hostname of the TDengine server.

#### `-port` (type: `int`, default: `6030`)

Port of the TDengine server.


